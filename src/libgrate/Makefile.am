noinst_LTLIBRARIES = libgrate.la

libgrate_la_CPPFLAGS = \
	-I$(top_srcdir)/include

libgrate_la_CFLAGS = \
	$(PNG_CFLAGS)

libgrate_la_SOURCES = \
	display.c \
	fs_ir.h \
	fs_ir.c \
	grate.c \
	grate.h \
	libgrate-private.h \
	matrix.c \
	matrix.h \
	profile.c

libgrate_la_LIBADD = \
	../libhost1x/libhost1x.la \
	$(PNG_LIBS) \
	-lm \
	-lrt

if ENABLE_CGC
BUILT_SOURCES = \
	lex.fragment_asm.c \
	lex.linker_asm.c \
	lex.vertex_asm.c \
	fragment_asm.tab.c \
	linker_asm.tab.c \
	vertex_asm.tab.c

CLEANFILES = \
	fragment_asm.tab.h \
	fragment_asm.tab.c \
	linker_asm.tab.h \
	linker_asm.tab.c \
	vertex_asm.tab.h \
	vertex_asm.tab.c \
	lex.fragment_asm.c \
	lex.linker_asm.c \
	lex.vertex_asm.c

lex.vertex_asm.c: vertex_asm_lexer.l vertex_asm.tab.c
	$(LEX) -P vertex_asm --nounput vertex_asm_lexer.l

vertex_asm.tab.c: vertex_asm_parser.y
	$(YACC) -p vertex_asm -b vertex_asm -d --debug vertex_asm_parser.y

lex.fragment_asm.c: fragment_asm_lexer.l fragment_asm.tab.c
	$(LEX) -P fragment_asm --nounput fragment_asm_lexer.l

fragment_asm.tab.c: fragment_asm_parser.y
	$(YACC) -p fragment_asm -b fragment_asm -d --debug fragment_asm_parser.y

lex.linker_asm.c: linker_asm_lexer.l linker_asm.tab.c
	$(LEX) -P linker_asm --nounput linker_asm_lexer.l

linker_asm.tab.c: linker_asm_parser.y
	$(YACC) -p linker_asm -b linker_asm -d --debug linker_asm_parser.y

libgrate_la_SOURCES += \
	fragment_asm.tab.c \
	fragment_disasm.c \
	lex.fragment_asm.c \
	lex.linker_asm.c \
	lex.vertex_asm.c \
	linker_asm.tab.c \
	linker_disasm.c \
	shader-cgc.c \
	vertex_asm.tab.c \
	vertex_disasm.c

libgrate_la_LIBADD += \
	../libcgc/libcgc.la
else
libgrate_la_SOURCES += \
	shader-dummy.c
endif
